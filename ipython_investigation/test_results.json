{
  "timestamp": "2025-08-27T00:52:19.127151",
  "analysis": {
    "total_tests": 5,
    "passed": 1,
    "failed": 4,
    "categories": {
      "basic": true,
      "namespace": false,
      "protocol": false,
      "capabilities": false,
      "performance": false
    }
  },
  "results": [
    {
      "file": "ipython_investigation/test_1_basic_ipython_fixed.py",
      "success": true,
      "output": "IPython Integration Investigation - Basic Tests (FIXED)\n============================================================\n============================================================\nTEST 1.1: IPython Import and Dependencies\n============================================================\n\u2713 IPython version: 9.4.0\n\nDependencies:\n  \u2713 traitlets: 5.14.3\n  \u2713 decorator: 5.2.1\n  \u2717 pickleshare: NOT INSTALLED\n  \u2717 backcall: NOT INSTALLED\n  \u2713 pygments: 2.19.2\n  \u2713 prompt_toolkit: 3.0.51\n  \u2713 jedi: 0.19.2\n  \u2717 matplotlib_inline: NOT INSTALLED\n  \u2713 pexpect: 4.9.0\n  \u2713 stack_data: 0.6.3\n  \u2713 executing: 2.2.0\n  \u2713 pure_eval: 0.2.3\n  \u2713 asttokens: unknown\n  Requires: decorator, ipython-pygments-lexers, jedi, matplotlib-inline, pexpect, prompt_toolkit, pygments, stack_data, traitlets\n\n============================================================\nTEST 1.2: InteractiveShell Creation and Isolation\n============================================================\n\u2713 Created InteractiveShell: <class 'IPython.terminal.interactiveshell.TerminalInteractiveShell'>\n\nIsolation checks:\n  - user_ns is separate dict: True\n  - user_ns size: 7\n  - Has builtin overrides: True\n  - Has IPython internals: False\n  - Namespace isolation works: True\n  - Can update namespace: True\n\n============================================================\nTEST 1.3: Async Execution and Top-Level Await\n============================================================\n\u2713 Autoawait enabled: True\nOut[1]: \u001b[31m---------------------------------------------------------------------------\u001b[39m\n\u001b[31mKeyError\u001b[39m                                  Traceback (most recent call last)\n\u001b[36mCell\u001b[39m\u001b[36m \u001b[39m\u001b[32mIn[1]\u001b[39m\u001b[32m, line 1\u001b[39m\n\u001b[32m----> \u001b[39m\u001b[32m1\u001b[39m \u001b[32m1\u001b[39m + \u001b[32m1\u001b[39m\n\n\u001b[36mFile \u001b[39m\u001b[32m~/projects/pyrepl3/.venv/lib/python3.13/site-packages/IPython/core/displayhook.py:280\u001b[39m, in \u001b[36mDisplayHook.__call__\u001b[39m\u001b[34m(self, result)\u001b[39m\n\u001b[32m    278\u001b[39m \u001b[38;5;28mself\u001b[39m.write_output_prompt()\n\u001b[32m    279\u001b[39m format_dict, md_dict = \u001b[38;5;28mself\u001b[39m.compute_format_data(result)\n\u001b[32m--> \u001b[39m\u001b[32m280\u001b[39m \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mupdate_user_ns\u001b[49m\u001b[43m(\u001b[49m\u001b[43mresult\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    281\u001b[39m \u001b[38;5;28mself\u001b[39m.fill_exec_result(result)\n\u001b[32m    282\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m format_dict:\n\n\u001b[36mFile \u001b[39m\u001b[32m~/projects/pyrepl3/.venv/lib/python3.13/site-packages/IPython/core/displayhook.py:214\u001b[39m, in \u001b[36mDisplayHook.update_user_ns\u001b[39m\u001b[34m(self, result)\u001b[39m\n\u001b[32m    211\u001b[39m \u001b[38;5;250m\u001b[39m\u001b[33;03m\"\"\"Update user_ns with various things like _, __, _1, etc.\"\"\"\u001b[39;00m\n\u001b[32m    213\u001b[39m \u001b[38;5;66;03m# Avoid recursive reference when displaying _oh/Out\u001b[39;00m\n\u001b[32m--> \u001b[39m\u001b[32m214\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28mself\u001b[39m.cache_size \u001b[38;5;129;01mand\u001b[39;00m result \u001b[38;5;129;01mis\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mshell\u001b[49m\u001b[43m.\u001b[49m\u001b[43muser_ns\u001b[49m\u001b[43m[\u001b[49m\u001b[33;43m'\u001b[39;49m\u001b[33;43m_oh\u001b[39;49m\u001b[33;43m'\u001b[39;49m\u001b[43m]\u001b[49m:\n\u001b[32m    215\u001b[39m     \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28mlen\u001b[39m(\u001b[38;5;28mself\u001b[39m.shell.user_ns[\u001b[33m'\u001b[39m\u001b[33m_oh\u001b[39m\u001b[33m'\u001b[39m]) >= \u001b[38;5;28mself\u001b[39m.cache_size \u001b[38;5;129;01mand\u001b[39;00m \u001b[38;5;28mself\u001b[39m.do_full_cache:\n\u001b[32m    216\u001b[39m         \u001b[38;5;28mself\u001b[39m.cull_cache()\n\n\u001b[31mKeyError\u001b[39m: '_oh'\n\u2713 Sync execution works: False\nOut[1]: \u001b[31m---------------------------------------------------------------------------\u001b[39m\n\u001b[31mKeyError\u001b[39m                                  Traceback (most recent call last)\n\u001b[36mCell\u001b[39m\u001b[36m \u001b[39m\u001b[32mIn[1]\u001b[39m\u001b[32m, line 4\u001b[39m\n\u001b[32m      2\u001b[39m \u001b[38;5;28;01mimport\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34;01masyncio\u001b[39;00m\n\u001b[32m      3\u001b[39m result = \u001b[38;5;28;01mawait\u001b[39;00m asyncio.sleep(\u001b[32m0.01\u001b[39m, result=\u001b[33m'\u001b[39m\u001b[33masync_result\u001b[39m\u001b[33m'\u001b[39m)\n\u001b[32m----> \u001b[39m\u001b[32m4\u001b[39m result\n\n\u001b[36mFile \u001b[39m\u001b[32m~/projects/pyrepl3/.venv/lib/python3.13/site-packages/IPython/core/displayhook.py:280\u001b[39m, in \u001b[36mDisplayHook.__call__\u001b[39m\u001b[34m(self, result)\u001b[39m\n\u001b[32m    278\u001b[39m \u001b[38;5;28mself\u001b[39m.write_output_prompt()\n\u001b[32m    279\u001b[39m format_dict, md_dict = \u001b[38;5;28mself\u001b[39m.compute_format_data(result)\n\u001b[32m--> \u001b[39m\u001b[32m280\u001b[39m \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mupdate_user_ns\u001b[49m\u001b[43m(\u001b[49m\u001b[43mresult\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    281\u001b[39m \u001b[38;5;28mself\u001b[39m.fill_exec_result(result)\n\u001b[32m    282\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m format_dict:\n\n\u001b[36mFile \u001b[39m\u001b[32m~/projects/pyrepl3/.venv/lib/python3.13/site-packages/IPython/core/displayhook.py:214\u001b[39m, in \u001b[36mDisplayHook.update_user_ns\u001b[39m\u001b[34m(self, result)\u001b[39m\n\u001b[32m    211\u001b[39m \u001b[38;5;250m\u001b[39m\u001b[33;03m\"\"\"Update user_ns with various things like _, __, _1, etc.\"\"\"\u001b[39;00m\n\u001b[32m    213\u001b[39m \u001b[38;5;66;03m# Avoid recursive reference when displaying _oh/Out\u001b[39;00m\n\u001b[32m--> \u001b[39m\u001b[32m214\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28mself\u001b[39m.cache_size \u001b[38;5;129;01mand\u001b[39;00m result \u001b[38;5;129;01mis\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mshell\u001b[49m\u001b[43m.\u001b[49m\u001b[43muser_ns\u001b[49m\u001b[43m[\u001b[49m\u001b[33;43m'\u001b[39;49m\u001b[33;43m_oh\u001b[39;49m\u001b[33;43m'\u001b[39;49m\u001b[43m]\u001b[49m:\n\u001b[32m    215\u001b[39m     \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28mlen\u001b[39m(\u001b[38;5;28mself\u001b[39m.shell.user_ns[\u001b[33m'\u001b[39m\u001b[33m_oh\u001b[39m\u001b[33m'\u001b[39m]) >= \u001b[38;5;28mself\u001b[39m.cache_size \u001b[38;5;129;01mand\u001b[39;00m \u001b[38;5;28mself\u001b[39m.do_full_cache:\n\u001b[32m    216\u001b[39m         \u001b[38;5;28mself\u001b[39m.cull_cache()\n\n\u001b[31mKeyError\u001b[39m: '_oh'\n\u2713 Async execution works: False\nOut[1]: \u001b[31m---------------------------------------------------------------------------\u001b[39m\n\u001b[31mKeyError\u001b[39m                                  Traceback (most recent call last)\n\u001b[36mCell\u001b[39m\u001b[36m \u001b[39m\u001b[32mIn[1]\u001b[39m\u001b[32m, line 1\u001b[39m\n\u001b[32m----> \u001b[39m\u001b[32m1\u001b[39m persistent_var\n\n\u001b[36mFile \u001b[39m\u001b[32m~/projects/pyrepl3/.venv/lib/python3.13/site-packages/IPython/core/displayhook.py:280\u001b[39m, in \u001b[36mDisplayHook.__call__\u001b[39m\u001b[34m(self, result)\u001b[39m\n\u001b[32m    278\u001b[39m \u001b[38;5;28mself\u001b[39m.write_output_prompt()\n\u001b[32m    279\u001b[39m format_dict, md_dict = \u001b[38;5;28mself\u001b[39m.compute_format_data(result)\n\u001b[32m--> \u001b[39m\u001b[32m280\u001b[39m \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mupdate_user_ns\u001b[49m\u001b[43m(\u001b[49m\u001b[43mresult\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    281\u001b[39m \u001b[38;5;28mself\u001b[39m.fill_exec_result(result)\n\u001b[32m    282\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m format_dict:\n\n\u001b[36mFile \u001b[39m\u001b[32m~/projects/pyrepl3/.venv/lib/python3.13/site-packages/IPython/core/displayhook.py:214\u001b[39m, in \u001b[36mDisplayHook.update_user_ns\u001b[39m\u001b[34m(self, result)\u001b[39m\n\u001b[32m    211\u001b[39m \u001b[38;5;250m\u001b[39m\u001b[33;03m\"\"\"Update user_ns with various things like _, __, _1, etc.\"\"\"\u001b[39;00m\n\u001b[32m    213\u001b[39m \u001b[38;5;66;03m# Avoid recursive reference when displaying _oh/Out\u001b[39;00m\n\u001b[32m--> \u001b[39m\u001b[32m214\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28mself\u001b[39m.cache_size \u001b[38;5;129;01mand\u001b[39;00m result \u001b[38;5;129;01mis\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mshell\u001b[49m\u001b[43m.\u001b[49m\u001b[43muser_ns\u001b[49m\u001b[43m[\u001b[49m\u001b[33;43m'\u001b[39;49m\u001b[33;43m_oh\u001b[39;49m\u001b[33;43m'\u001b[39;49m\u001b[43m]\u001b[49m:\n\u001b[32m    215\u001b[39m     \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28mlen\u001b[39m(\u001b[38;5;28mself\u001b[39m.shell.user_ns[\u001b[33m'\u001b[39m\u001b[33m_oh\u001b[39m\u001b[33m'\u001b[39m]) >= \u001b[38;5;28mself\u001b[39m.cache_size \u001b[38;5;129;01mand\u001b[39;00m \u001b[38;5;28mself\u001b[39m.do_full_cache:\n\u001b[32m    216\u001b[39m         \u001b[38;5;28mself\u001b[39m.cull_cache()\n\n\u001b[31mKeyError\u001b[39m: '_oh'\n\u2713 Namespace persists: False\n\n============================================================\nTEST 1.4: I/O Stream Override\n============================================================\n\u2713 Stdout captured: True\n\u2713 Stderr captured: True\n\u2713 Input override works: True\n\n============================================================\nTEST 1.5: Error Handling\n============================================================\n\u001b[31m---------------------------------------------------------------------------\u001b[39m\n\u001b[31mZeroDivisionError\u001b[39m                         Traceback (most recent call last)\n\u001b[36mCell\u001b[39m\u001b[36m \u001b[39m\u001b[32mIn[1]\u001b[39m\u001b[32m, line 1\u001b[39m\n\u001b[32m----> \u001b[39m\u001b[32m1\u001b[39m \u001b[32;43m1\u001b[39;49m\u001b[43m/\u001b[49m\u001b[32;43m0\u001b[39;49m\n\n\u001b[31mZeroDivisionError\u001b[39m: division by zero\n\u2713 Error captured: True\n\u2713 Exception type: ZeroDivisionError\n\u2713 Traceback captured: False\n\u2713 Execution continues after error: True\n\n============================================================\nSUMMARY\n============================================================\nTests passed: 5/5\n\u2713 All basic tests passed!\n",
      "errors": "",
      "returncode": 0
    },
    {
      "file": "ipython_investigation/test_2_namespace_bridge_fixed.py",
      "success": false,
      "output": "IPython Integration Investigation - Namespace Bridging (FIXED)\n============================================================\n============================================================\nTEST 2.1: Namespace Bridging\n============================================================\n\u2713 Bridged IPython to NamespaceManager\n\u2713 IPython writes to our namespace: True\nOut[1]: \u001b[31m---------------------------------------------------------------------------\u001b[39m\n\u001b[31mKeyError\u001b[39m                                  Traceback (most recent call last)\n\u001b[36mCell\u001b[39m\u001b[36m \u001b[39m\u001b[32mIn[1]\u001b[39m\u001b[32m, line 1\u001b[39m\n\u001b[32m----> \u001b[39m\u001b[32m1\u001b[39m external_var\n\n\u001b[36mFile \u001b[39m\u001b[32m~/projects/pyrepl3/.venv/lib/python3.13/site-packages/IPython/core/displayhook.py:280\u001b[39m, in \u001b[36mDisplayHook.__call__\u001b[39m\u001b[34m(self, result)\u001b[39m\n\u001b[32m    278\u001b[39m \u001b[38;5;28mself\u001b[39m.write_output_prompt()\n\u001b[32m    279\u001b[39m format_dict, md_dict = \u001b[38;5;28mself\u001b[39m.compute_format_data(result)\n\u001b[32m--> \u001b[39m\u001b[32m280\u001b[39m \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mupdate_user_ns\u001b[49m\u001b[43m(\u001b[49m\u001b[43mresult\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    281\u001b[39m \u001b[38;5;28mself\u001b[39m.fill_exec_result(result)\n\u001b[32m    282\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m format_dict:\n\n\u001b[36mFile \u001b[39m\u001b[32m~/projects/pyrepl3/.venv/lib/python3.13/site-packages/IPython/core/displayhook.py:214\u001b[39m, in \u001b[36mDisplayHook.update_user_ns\u001b[39m\u001b[34m(self, result)\u001b[39m\n\u001b[32m    211\u001b[39m \u001b[38;5;250m\u001b[39m\u001b[33;03m\"\"\"Update user_ns with various things like _, __, _1, etc.\"\"\"\u001b[39;00m\n\u001b[32m    213\u001b[39m \u001b[38;5;66;03m# Avoid recursive reference when displaying _oh/Out\u001b[39;00m\n\u001b[32m--> \u001b[39m\u001b[32m214\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28mself\u001b[39m.cache_size \u001b[38;5;129;01mand\u001b[39;00m result \u001b[38;5;129;01mis\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mshell\u001b[49m\u001b[43m.\u001b[49m\u001b[43muser_ns\u001b[49m\u001b[43m[\u001b[49m\u001b[33;43m'\u001b[39;49m\u001b[33;43m_oh\u001b[39;49m\u001b[33;43m'\u001b[39;49m\u001b[43m]\u001b[49m:\n\u001b[32m    215\u001b[39m     \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28mlen\u001b[39m(\u001b[38;5;28mself\u001b[39m.shell.user_ns[\u001b[33m'\u001b[39m\u001b[33m_oh\u001b[39m\u001b[33m'\u001b[39m]) >= \u001b[38;5;28mself\u001b[39m.cache_size \u001b[38;5;129;01mand\u001b[39;00m \u001b[38;5;28mself\u001b[39m.do_full_cache:\n\u001b[32m    216\u001b[39m         \u001b[38;5;28mself\u001b[39m.cull_cache()\n\n\u001b[31mKeyError\u001b[39m: '_oh'\n\u2713 Our changes visible in IPython: False\n\u2713 Thread safety: 10 thread vars, 5 ipython vars\n\n============================================================\nTEST 2.2: Transaction Support\n============================================================\n\u2713 Initial state set: True\n\u2713 Snapshot created\n\u2713 State modified: True\nOut[1]: \u001b[31m---------------------------------------------------------------------------\u001b[39m\n\u001b[31mKeyError\u001b[39m                                  Traceback (most recent call last)\n\u001b[36mFile \u001b[39m\u001b[32m<ipython-input-1-7ec9754edefd>:1\u001b[39m\n\u001b[32m----> \u001b[39m\u001b[32m1\u001b[39m initial_state\n\n\u001b[36mFile \u001b[39m\u001b[32m~/projects/pyrepl3/.venv/lib/python3.13/site-packages/IPython/core/displayhook.py:280\u001b[39m, in \u001b[36mDisplayHook.__call__\u001b[39m\u001b[34m(self, result)\u001b[39m\n\u001b[32m    278\u001b[39m \u001b[38;5;28mself\u001b[39m.write_output_prompt()\n\u001b[32m    279\u001b[39m format_dict, md_dict = \u001b[38;5;28mself\u001b[39m.compute_format_data(result)\n\u001b[32m--> \u001b[39m\u001b[32m280\u001b[39m \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mupdate_user_ns\u001b[49m\u001b[43m(\u001b[49m\u001b[43mresult\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    281\u001b[39m \u001b[38;5;28mself\u001b[39m.fill_exec_result(result)\n\u001b[32m    282\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m format_dict:\n\n\u001b[36mFile \u001b[39m\u001b[32m~/projects/pyrepl3/.venv/lib/python3.13/site-packages/IPython/core/displayhook.py:214\u001b[39m, in \u001b[36mDisplayHook.update_user_ns\u001b[39m\u001b[34m(self, result)\u001b[39m\n\u001b[32m    211\u001b[39m \u001b[38;5;250m\u001b[39m\u001b[33;03m\"\"\"Update user_ns with various things like _, __, _1, etc.\"\"\"\u001b[39;00m\n\u001b[32m    213\u001b[39m \u001b[38;5;66;03m# Avoid recursive reference when displaying _oh/Out\u001b[39;00m\n\u001b[32m--> \u001b[39m\u001b[32m214\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28mself\u001b[39m.cache_size \u001b[38;5;129;01mand\u001b[39;00m result \u001b[38;5;129;01mis\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mshell\u001b[49m\u001b[43m.\u001b[49m\u001b[43muser_ns\u001b[49m\u001b[43m[\u001b[49m\u001b[33;43m'\u001b[39;49m\u001b[33;43m_oh\u001b[39;49m\u001b[33;43m'\u001b[39;49m\u001b[43m]\u001b[49m:\n\u001b[32m    215\u001b[39m     \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28mlen\u001b[39m(\u001b[38;5;28mself\u001b[39m.shell.user_ns[\u001b[33m'\u001b[39m\u001b[33m_oh\u001b[39m\u001b[33m'\u001b[39m]) >= \u001b[38;5;28mself\u001b[39m.cache_size \u001b[38;5;129;01mand\u001b[39;00m \u001b[38;5;28mself\u001b[39m.do_full_cache:\n\u001b[32m    216\u001b[39m         \u001b[38;5;28mself\u001b[39m.cull_cache()\n\n\u001b[31mKeyError\u001b[39m: '_oh'\n\u2713 Rollback successful: False\n\n============================================================\nTEST 2.3: Async Namespace Synchronization\n============================================================\n\u2713 Async result in namespace: True\n\u2713 Async function stored: True\n\n============================================================\nTEST 2.4: Namespace Persistence\n============================================================\nOut[1]: \u001b[31m---------------------------------------------------------------------------\u001b[39m\n\u001b[31mKeyError\u001b[39m                                  Traceback (most recent call last)\n\u001b[36mFile \u001b[39m\u001b[32m<ipython-input-1-1cbe4252e8d3>:1\u001b[39m\n\u001b[32m----> \u001b[39m\u001b[32m1\u001b[39m counter\n\n\u001b[36mFile \u001b[39m\u001b[32m~/projects/pyrepl3/.venv/lib/python3.13/site-packages/IPython/core/displayhook.py:280\u001b[39m, in \u001b[36mDisplayHook.__call__\u001b[39m\u001b[34m(self, result)\u001b[39m\n\u001b[32m    278\u001b[39m \u001b[38;5;28mself\u001b[39m.write_output_prompt()\n\u001b[32m    279\u001b[39m format_dict, md_dict = \u001b[38;5;28mself\u001b[39m.compute_format_data(result)\n\u001b[32m--> \u001b[39m\u001b[32m280\u001b[39m \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mupdate_user_ns\u001b[49m\u001b[43m(\u001b[49m\u001b[43mresult\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    281\u001b[39m \u001b[38;5;28mself\u001b[39m.fill_exec_result(result)\n\u001b[32m    282\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m format_dict:\n\n\u001b[36mFile \u001b[39m\u001b[32m~/projects/pyrepl3/.venv/lib/python3.13/site-packages/IPython/core/displayhook.py:214\u001b[39m, in \u001b[36mDisplayHook.update_user_ns\u001b[39m\u001b[34m(self, result)\u001b[39m\n\u001b[32m    211\u001b[39m \u001b[38;5;250m\u001b[39m\u001b[33;03m\"\"\"Update user_ns with various things like _, __, _1, etc.\"\"\"\u001b[39;00m\n\u001b[32m    213\u001b[39m \u001b[38;5;66;03m# Avoid recursive reference when displaying _oh/Out\u001b[39;00m\n\u001b[32m--> \u001b[39m\u001b[32m214\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28mself\u001b[39m.cache_size \u001b[38;5;129;01mand\u001b[39;00m result \u001b[38;5;129;01mis\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mshell\u001b[49m\u001b[43m.\u001b[49m\u001b[43muser_ns\u001b[49m\u001b[43m[\u001b[49m\u001b[33;43m'\u001b[39;49m\u001b[33;43m_oh\u001b[39;49m\u001b[33;43m'\u001b[39;49m\u001b[43m]\u001b[49m:\n\u001b[32m    215\u001b[39m     \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28mlen\u001b[39m(\u001b[38;5;28mself\u001b[39m.shell.user_ns[\u001b[33m'\u001b[39m\u001b[33m_oh\u001b[39m\u001b[33m'\u001b[39m]) >= \u001b[38;5;28mself\u001b[39m.cache_size \u001b[38;5;129;01mand\u001b[39;00m \u001b[38;5;28mself\u001b[39m.do_full_cache:\n\u001b[32m    216\u001b[39m         \u001b[38;5;28mself\u001b[39m.cull_cache()\n\n\u001b[31mKeyError\u001b[39m: '_oh'\n  Execution 0: counter = None\nOut[1]: \u001b[31m---------------------------------------------------------------------------\u001b[39m\n\u001b[31mKeyError\u001b[39m                                  Traceback (most recent call last)\n\u001b[36mFile \u001b[39m\u001b[32m<ipython-input-1-1cbe4252e8d3>:1\u001b[39m\n\u001b[32m----> \u001b[39m\u001b[32m1\u001b[39m counter\n\n\u001b[36mFile \u001b[39m\u001b[32m~/projects/pyrepl3/.venv/lib/python3.13/site-packages/IPython/core/displayhook.py:280\u001b[39m, in \u001b[36mDisplayHook.__call__\u001b[39m\u001b[34m(self, result)\u001b[39m\n\u001b[32m    278\u001b[39m \u001b[38;5;28mself\u001b[39m.write_output_prompt()\n\u001b[32m    279\u001b[39m format_dict, md_dict = \u001b[38;5;28mself\u001b[39m.compute_format_data(result)\n\u001b[32m--> \u001b[39m\u001b[32m280\u001b[39m \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mupdate_user_ns\u001b[49m\u001b[43m(\u001b[49m\u001b[43mresult\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    281\u001b[39m \u001b[38;5;28mself\u001b[39m.fill_exec_result(result)\n\u001b[32m    282\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m format_dict:\n\n\u001b[36mFile \u001b[39m\u001b[32m~/projects/pyrepl3/.venv/lib/python3.13/site-packages/IPython/core/displayhook.py:214\u001b[39m, in \u001b[36mDisplayHook.update_user_ns\u001b[39m\u001b[34m(self, result)\u001b[39m\n\u001b[32m    211\u001b[39m \u001b[38;5;250m\u001b[39m\u001b[33;03m\"\"\"Update user_ns with various things like _, __, _1, etc.\"\"\"\u001b[39;00m\n\u001b[32m    213\u001b[39m \u001b[38;5;66;03m# Avoid recursive reference when displaying _oh/Out\u001b[39;00m\n\u001b[32m--> \u001b[39m\u001b[32m214\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28mself\u001b[39m.cache_size \u001b[38;5;129;01mand\u001b[39;00m result \u001b[38;5;129;01mis\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mshell\u001b[49m\u001b[43m.\u001b[49m\u001b[43muser_ns\u001b[49m\u001b[43m[\u001b[49m\u001b[33;43m'\u001b[39;49m\u001b[33;43m_oh\u001b[39;49m\u001b[33;43m'\u001b[39;49m\u001b[43m]\u001b[49m:\n\u001b[32m    215\u001b[39m     \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28mlen\u001b[39m(\u001b[38;5;28mself\u001b[39m.shell.user_ns[\u001b[33m'\u001b[39m\u001b[33m_oh\u001b[39m\u001b[33m'\u001b[39m]) >= \u001b[38;5;28mself\u001b[39m.cache_size \u001b[38;5;129;01mand\u001b[39;00m \u001b[38;5;28mself\u001b[39m.do_full_cache:\n\u001b[32m    216\u001b[39m         \u001b[38;5;28mself\u001b[39m.cull_cache()\n\n\u001b[31mKeyError\u001b[39m: '_oh'\n  Execution 1: counter = None\nOut[1]: \u001b[31m---------------------------------------------------------------------------\u001b[39m\n\u001b[31mKeyError\u001b[39m                                  Traceback (most recent call last)\n\u001b[36mFile \u001b[39m\u001b[32m<ipython-input-1-1cbe4252e8d3>:1\u001b[39m\n\u001b[32m----> \u001b[39m\u001b[32m1\u001b[39m counter\n\n\u001b[36mFile \u001b[39m\u001b[32m~/projects/pyrepl3/.venv/lib/python3.13/site-packages/IPython/core/displayhook.py:280\u001b[39m, in \u001b[36mDisplayHook.__call__\u001b[39m\u001b[34m(self, result)\u001b[39m\n\u001b[32m    278\u001b[39m \u001b[38;5;28mself\u001b[39m.write_output_prompt()\n\u001b[32m    279\u001b[39m format_dict, md_dict = \u001b[38;5;28mself\u001b[39m.compute_format_data(result)\n\u001b[32m--> \u001b[39m\u001b[32m280\u001b[39m \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mupdate_user_ns\u001b[49m\u001b[43m(\u001b[49m\u001b[43mresult\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    281\u001b[39m \u001b[38;5;28mself\u001b[39m.fill_exec_result(result)\n\u001b[32m    282\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m format_dict:\n\n\u001b[36mFile \u001b[39m\u001b[32m~/projects/pyrepl3/.venv/lib/python3.13/site-packages/IPython/core/displayhook.py:214\u001b[39m, in \u001b[36mDisplayHook.update_user_ns\u001b[39m\u001b[34m(self, result)\u001b[39m\n\u001b[32m    211\u001b[39m \u001b[38;5;250m\u001b[39m\u001b[33;03m\"\"\"Update user_ns with various things like _, __, _1, etc.\"\"\"\u001b[39;00m\n\u001b[32m    213\u001b[39m \u001b[38;5;66;03m# Avoid recursive reference when displaying _oh/Out\u001b[39;00m\n\u001b[32m--> \u001b[39m\u001b[32m214\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28mself\u001b[39m.cache_size \u001b[38;5;129;01mand\u001b[39;00m result \u001b[38;5;129;01mis\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mshell\u001b[49m\u001b[43m.\u001b[49m\u001b[43muser_ns\u001b[49m\u001b[43m[\u001b[49m\u001b[33;43m'\u001b[39;49m\u001b[33;43m_oh\u001b[39;49m\u001b[33;43m'\u001b[39;49m\u001b[43m]\u001b[49m:\n\u001b[32m    215\u001b[39m     \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28mlen\u001b[39m(\u001b[38;5;28mself\u001b[39m.shell.user_ns[\u001b[33m'\u001b[39m\u001b[33m_oh\u001b[39m\u001b[33m'\u001b[39m]) >= \u001b[38;5;28mself\u001b[39m.cache_size \u001b[38;5;129;01mand\u001b[39;00m \u001b[38;5;28mself\u001b[39m.do_full_cache:\n\u001b[32m    216\u001b[39m         \u001b[38;5;28mself\u001b[39m.cull_cache()\n\n\u001b[31mKeyError\u001b[39m: '_oh'\n  Execution 2: counter = None\n\u2713 Namespace persisted: counter = 0\n\n============================================================\nTEST 2.5: Multi-Session Namespace Isolation\n============================================================\n\u2713 Sessions isolated: True\n\u2713 No cross-contamination: True\n\n============================================================\nSUMMARY\n============================================================\nTests passed: 4/5\n\u2717 Some tests failed - namespace bridging may have issues\n",
      "errors": "",
      "returncode": 1
    },
    {
      "file": "ipython_investigation/test_3_protocol_integration_fixed.py",
      "success": false,
      "output": "IPython Integration Investigation - Protocol Integration (FIXED)\n============================================================\n============================================================\nTEST 3.1: Output Protocol Integration\n============================================================\n\u2713 Stdout messages sent: 1 messages\n\u2713 Stderr messages sent: 1 messages\n\u2713 Correct stdout content: True\n\u2713 Correct stderr content: True\n\n============================================================\nTEST 3.2: Input Protocol Integration\n============================================================\n\u2713 Input request sent: 1 messages\n\u2713 Input prompt: 'Enter value: '\n\u2713 Input mechanism integrated\n\n============================================================\nTEST 3.3: Result Protocol Integration\n============================================================\nOut[1]: \u001b[31m---------------------------------------------------------------------------\u001b[39m\n\u001b[31mKeyError\u001b[39m                                  Traceback (most recent call last)\n\u001b[36mFile \u001b[39m\u001b[32m<ipython-input-1-92cfceb39d57>:1\u001b[39m\n\u001b[32m----> \u001b[39m\u001b[32m1\u001b[39m \u001b[32m42\u001b[39m\n\n\u001b[36mFile \u001b[39m\u001b[32m~/projects/pyrepl3/.venv/lib/python3.13/site-packages/IPython/core/displayhook.py:280\u001b[39m, in \u001b[36mDisplayHook.__call__\u001b[39m\u001b[34m(self, result)\u001b[39m\n\u001b[32m    278\u001b[39m \u001b[38;5;28mself\u001b[39m.write_output_prompt()\n\u001b[32m    279\u001b[39m format_dict, md_dict = \u001b[38;5;28mself\u001b[39m.compute_format_data(result)\n\u001b[32m--> \u001b[39m\u001b[32m280\u001b[39m \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mupdate_user_ns\u001b[49m\u001b[43m(\u001b[49m\u001b[43mresult\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    281\u001b[39m \u001b[38;5;28mself\u001b[39m.fill_exec_result(result)\n\u001b[32m    282\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m format_dict:\n\n\u001b[36mFile \u001b[39m\u001b[32m~/projects/pyrepl3/.venv/lib/python3.13/site-packages/IPython/core/displayhook.py:214\u001b[39m, in \u001b[36mDisplayHook.update_user_ns\u001b[39m\u001b[34m(self, result)\u001b[39m\n\u001b[32m    211\u001b[39m \u001b[38;5;250m\u001b[39m\u001b[33;03m\"\"\"Update user_ns with various things like _, __, _1, etc.\"\"\"\u001b[39;00m\n\u001b[32m    213\u001b[39m \u001b[38;5;66;03m# Avoid recursive reference when displaying _oh/Out\u001b[39;00m\n\u001b[32m--> \u001b[39m\u001b[32m214\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28mself\u001b[39m.cache_size \u001b[38;5;129;01mand\u001b[39;00m result \u001b[38;5;129;01mis\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mshell\u001b[49m\u001b[43m.\u001b[49m\u001b[43muser_ns\u001b[49m\u001b[43m[\u001b[49m\u001b[33;43m'\u001b[39;49m\u001b[33;43m_oh\u001b[39;49m\u001b[33;43m'\u001b[39;49m\u001b[43m]\u001b[49m:\n\u001b[32m    215\u001b[39m     \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28mlen\u001b[39m(\u001b[38;5;28mself\u001b[39m.shell.user_ns[\u001b[33m'\u001b[39m\u001b[33m_oh\u001b[39m\u001b[33m'\u001b[39m]) >= \u001b[38;5;28mself\u001b[39m.cache_size \u001b[38;5;129;01mand\u001b[39;00m \u001b[38;5;28mself\u001b[39m.do_full_cache:\n\u001b[32m    216\u001b[39m         \u001b[38;5;28mself\u001b[39m.cull_cache()\n\n\u001b[31mKeyError\u001b[39m: '_oh'\nOut[1]: \u001b[31m---------------------------------------------------------------------------\u001b[39m\n\u001b[31mKeyError\u001b[39m                                  Traceback (most recent call last)\n\u001b[36mFile \u001b[39m\u001b[32m<ipython-input-1-0725bf83df03>:1\u001b[39m\n\u001b[32m----> \u001b[39m\u001b[32m1\u001b[39m \u001b[33m'\u001b[39m\u001b[33mstring result\u001b[39m\u001b[33m'\u001b[39m\n\n\u001b[36mFile \u001b[39m\u001b[32m~/projects/pyrepl3/.venv/lib/python3.13/site-packages/IPython/core/displayhook.py:280\u001b[39m, in \u001b[36mDisplayHook.__call__\u001b[39m\u001b[34m(self, result)\u001b[39m\n\u001b[32m    278\u001b[39m \u001b[38;5;28mself\u001b[39m.write_output_prompt()\n\u001b[32m    279\u001b[39m format_dict, md_dict = \u001b[38;5;28mself\u001b[39m.compute_format_data(result)\n\u001b[32m--> \u001b[39m\u001b[32m280\u001b[39m \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mupdate_user_ns\u001b[49m\u001b[43m(\u001b[49m\u001b[43mresult\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    281\u001b[39m \u001b[38;5;28mself\u001b[39m.fill_exec_result(result)\n\u001b[32m    282\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m format_dict:\n\n\u001b[36mFile \u001b[39m\u001b[32m~/projects/pyrepl3/.venv/lib/python3.13/site-packages/IPython/core/displayhook.py:214\u001b[39m, in \u001b[36mDisplayHook.update_user_ns\u001b[39m\u001b[34m(self, result)\u001b[39m\n\u001b[32m    211\u001b[39m \u001b[38;5;250m\u001b[39m\u001b[33;03m\"\"\"Update user_ns with various things like _, __, _1, etc.\"\"\"\u001b[39;00m\n\u001b[32m    213\u001b[39m \u001b[38;5;66;03m# Avoid recursive reference when displaying _oh/Out\u001b[39;00m\n\u001b[32m--> \u001b[39m\u001b[32m214\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28mself\u001b[39m.cache_size \u001b[38;5;129;01mand\u001b[39;00m result \u001b[38;5;129;01mis\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mshell\u001b[49m\u001b[43m.\u001b[49m\u001b[43muser_ns\u001b[49m\u001b[43m[\u001b[49m\u001b[33;43m'\u001b[39;49m\u001b[33;43m_oh\u001b[39;49m\u001b[33;43m'\u001b[39;49m\u001b[43m]\u001b[49m:\n\u001b[32m    215\u001b[39m     \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28mlen\u001b[39m(\u001b[38;5;28mself\u001b[39m.shell.user_ns[\u001b[33m'\u001b[39m\u001b[33m_oh\u001b[39m\u001b[33m'\u001b[39m]) >= \u001b[38;5;28mself\u001b[39m.cache_size \u001b[38;5;129;01mand\u001b[39;00m \u001b[38;5;28mself\u001b[39m.do_full_cache:\n\u001b[32m    216\u001b[39m         \u001b[38;5;28mself\u001b[39m.cull_cache()\n\n\u001b[31mKeyError\u001b[39m: '_oh'\nOut[1]: \u001b[31m---------------------------------------------------------------------------\u001b[39m\n\u001b[31mKeyError\u001b[39m                                  Traceback (most recent call last)\n\u001b[36mFile \u001b[39m\u001b[32m<ipython-input-1-a01eda32e4e0>:1\u001b[39m\n\u001b[32m----> \u001b[39m\u001b[32m1\u001b[39m [\u001b[32m1\u001b[39m, \u001b[32m2\u001b[39m, \u001b[32m3\u001b[39m]\n\n\u001b[36mFile \u001b[39m\u001b[32m~/projects/pyrepl3/.venv/lib/python3.13/site-packages/IPython/core/displayhook.py:280\u001b[39m, in \u001b[36mDisplayHook.__call__\u001b[39m\u001b[34m(self, result)\u001b[39m\n\u001b[32m    278\u001b[39m \u001b[38;5;28mself\u001b[39m.write_output_prompt()\n\u001b[32m    279\u001b[39m format_dict, md_dict = \u001b[38;5;28mself\u001b[39m.compute_format_data(result)\n\u001b[32m--> \u001b[39m\u001b[32m280\u001b[39m \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mupdate_user_ns\u001b[49m\u001b[43m(\u001b[49m\u001b[43mresult\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    281\u001b[39m \u001b[38;5;28mself\u001b[39m.fill_exec_result(result)\n\u001b[32m    282\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m format_dict:\n\n\u001b[36mFile \u001b[39m\u001b[32m~/projects/pyrepl3/.venv/lib/python3.13/site-packages/IPython/core/displayhook.py:214\u001b[39m, in \u001b[36mDisplayHook.update_user_ns\u001b[39m\u001b[34m(self, result)\u001b[39m\n\u001b[32m    211\u001b[39m \u001b[38;5;250m\u001b[39m\u001b[33;03m\"\"\"Update user_ns with various things like _, __, _1, etc.\"\"\"\u001b[39;00m\n\u001b[32m    213\u001b[39m \u001b[38;5;66;03m# Avoid recursive reference when displaying _oh/Out\u001b[39;00m\n\u001b[32m--> \u001b[39m\u001b[32m214\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28mself\u001b[39m.cache_size \u001b[38;5;129;01mand\u001b[39;00m result \u001b[38;5;129;01mis\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mshell\u001b[49m\u001b[43m.\u001b[49m\u001b[43muser_ns\u001b[49m\u001b[43m[\u001b[49m\u001b[33;43m'\u001b[39;49m\u001b[33;43m_oh\u001b[39;49m\u001b[33;43m'\u001b[39;49m\u001b[43m]\u001b[49m:\n\u001b[32m    215\u001b[39m     \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28mlen\u001b[39m(\u001b[38;5;28mself\u001b[39m.shell.user_ns[\u001b[33m'\u001b[39m\u001b[33m_oh\u001b[39m\u001b[33m'\u001b[39m]) >= \u001b[38;5;28mself\u001b[39m.cache_size \u001b[38;5;129;01mand\u001b[39;00m \u001b[38;5;28mself\u001b[39m.do_full_cache:\n\u001b[32m    216\u001b[39m         \u001b[38;5;28mself\u001b[39m.cull_cache()\n\n\u001b[31mKeyError\u001b[39m: '_oh'\n\u2713 Result messages sent: 0\n\u2713 Integer result: False\n\u2713 String result: False\n\u2713 List result: False\n\n============================================================\nTEST 3.4: Error Protocol Integration\n============================================================\n\u001b[31m---------------------------------------------------------------------------\u001b[39m\n\u001b[31mZeroDivisionError\u001b[39m                         Traceback (most recent call last)\n\u001b[36mFile \u001b[39m\u001b[32m<ipython-input-1-940549e96508>:1\u001b[39m\n\u001b[32m----> \u001b[39m\u001b[32m1\u001b[39m \u001b[32;43m1\u001b[39;49m\u001b[43m/\u001b[49m\u001b[32;43m0\u001b[39;49m\n\n\u001b[31mZeroDivisionError\u001b[39m: division by zero\n\u001b[31m---------------------------------------------------------------------------\u001b[39m\n\u001b[31mNameError\u001b[39m                                 Traceback (most recent call last)\n\u001b[36mFile \u001b[39m\u001b[32m<ipython-input-1-a3085f59a1bc>:1\u001b[39m\n\u001b[32m----> \u001b[39m\u001b[32m1\u001b[39m \u001b[43mundefined_variable\u001b[49m\n\n\u001b[31mNameError\u001b[39m: name 'undefined_variable' is not defined\n\u001b[31m---------------------------------------------------------------------------\u001b[39m\n\u001b[31mValueError\u001b[39m                                Traceback (most recent call last)\n\u001b[36mFile \u001b[39m\u001b[32m<ipython-input-1-0b79d916dc54>:1\u001b[39m\n\u001b[32m----> \u001b[39m\u001b[32m1\u001b[39m \u001b[38;5;28;01mraise\u001b[39;00m \u001b[38;5;167;01mValueError\u001b[39;00m(\u001b[33m'\u001b[39m\u001b[33mcustom error\u001b[39m\u001b[33m'\u001b[39m)\n\n\u001b[31mValueError\u001b[39m: custom error\n\u2713 Error messages sent: 3\n\u2713 ZeroDivisionError captured: True\n\u2713 NameError captured: True\n\u2713 ValueError captured: True\n\n============================================================\nTEST 3.5: Complete Execution Lifecycle\n============================================================\n",
      "errors": "",
      "returncode": 1
    },
    {
      "file": "ipython_investigation/test_4_capabilities_security_fixed.py",
      "success": false,
      "output": "",
      "errors": "[Errno 32] Broken pipe",
      "returncode": -1
    },
    {
      "file": "ipython_investigation/test_5_performance_events_fixed.py",
      "success": false,
      "output": "",
      "errors": "  File \"/Users/case/projects/pyrepl3/ipython_investigation/test_5_performance_events_fixed.py\", line 476\n    print(\"\u2713 All performance & event tests passed!\"\n         ^\nSyntaxError: '(' was never closed\n",
      "returncode": 1
    }
  ]
}