{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://example.org/review/report.schema.json",
  "title": "PR Review Report",
  "type": "object",
  "additionalProperties": false,
  "required": ["tool", "model", "timestamp", "pr", "summary", "assumptions", "findings", "tests", "exit_criteria"],
  "properties": {
    "tool": { "type": "string", "enum": ["claude-code", "codex-cli", "gemini-cli"] },
    "model": { "type": "string", "minLength": 1 },
    "timestamp": { "type": "string", "format": "date-time" },
    "pr": {
      "type": "object",
      "additionalProperties": false,
      "required": ["repo", "number", "head_sha", "branch", "link"],
      "properties": {
        "repo": { "type": "string" },
        "number": { "type": "integer" },
        "head_sha": { "type": "string" },
        "branch": { "type": "string" },
        "link": { "type": "string", "format": "uri" }
      }
    },
    "summary": { "type": "string", "minLength": 1, "maxLength": 5000 },
    "assumptions": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["text", "status"],
        "properties": {
          "text": { "type": "string", "minLength": 1 },
          "status": { "type": "string", "enum": ["validated", "falsified", "uncertain"] },
          "evidence": { "type": "array", "items": { "type": "string" } },
          "falsification_step": { "type": "string" }
        }
      }
    },
    "findings": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["category", "severity", "message", "must_fix"],
        "properties": {
          "category": { "type": "string", "enum": ["correctness", "security", "performance", "testing", "design", "architecture", "docs", "style", "maintainability"] },
          "severity": { "type": "string", "enum": ["low", "medium", "high", "critical"] },
          "file": { "type": "string" },
          "lines": { "type": "string", "pattern": "^\\d+(-\\d+)?$" },
          "message": { "type": "string", "minLength": 1 },
          "suggestion": { "type": "string" },
          "evidence": { "type": "array", "items": { "type": "string" } },
          "must_fix": { "type": "boolean" }
        }
      }
    },
    "tests": {
      "type": "object",
      "additionalProperties": false,
      "required": ["executed"],
      "properties": {
        "executed": { "type": "boolean" },
        "command": { "type": "string" },
        "exit_code": { "type": "integer" },
        "summary": { "type": "string" },
        "coverage": { "type": "number", "minimum": 0, "maximum": 100 }
      }
    },
    "metrics": {
      "type": "object",
      "additionalProperties": true
    },
    "evidence": { "type": "array", "items": { "type": "string" } },
    "exit_criteria": {
      "type": "object",
      "additionalProperties": false,
      "required": ["ready_for_pr"],
      "properties": {
        "ready_for_pr": { "type": "boolean" },
        "reasons": { "type": "array", "items": { "type": "string" } }
      }
    }
  }
}